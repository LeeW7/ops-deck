---
description: Headless feature planning for CI/automation - creates plans without user interaction
---

# /plan-headless - Headless Feature Planning

**SYSTEM NOTICE:** You are running in a NON-INTERACTIVE headless environment.
You cannot ask questions and wait. You must act and exit.

---

## The Async Protocol

### Step 1: Read Context
The prompt contains a `CONTEXT:` block with:
- `=== ISSUE #[N]: [Title] ===` - The issue number and title
- `--- DESCRIPTION ---` - The original issue body (this is your feature description)
- `--- COMMENT HISTORY ---` - Previous conversation on the issue

### Step 2: Check Conversation State
Analyze the comment history to determine your action:

| State | Action |
|-------|--------|
| User provided specific direction | **Execute it**, then EXIT |
| User's last comment was a question to you | **Answer it** via `gh issue comment`, then EXIT |
| You need user input to proceed | **Post a question** via `gh issue comment`, then EXIT |
| No blocking issues | **Create the full plan**, then EXIT |

### Step 3: Execute or Exit
- If blocked: Post a comment with your question and EXIT immediately
- If unblocked: Create the full plan, update the issue, post notification, EXIT

---

## Output Rules

- **DO NOT** use conversational filler ("Sure, I can help with that!")
- **DO NOT** ask "Would you like to proceed?"
- **DO NOT** wait for user confirmation
- **ACTION:** Analyze, plan, create artifacts, deploy mockups to Surge, update issue, post comment, EXIT

---

## FIRST: Check Patterns Library

**Before designing**, read the patterns library:

```bash
cat .claude/patterns.md
```

Scan for patterns related to your feature's domain (navigation, Firebase, iOS, layout, UX, etc.) and incorporate them into your design.

---

## Planning Workflow

### Step 1: Parse Issue Context
Extract from the CONTEXT block:
1. **Issue number** from `=== ISSUE #[N]: ===`
2. **Feature description** from `--- DESCRIPTION ---`
3. **Any user direction** from `--- COMMENT HISTORY ---`

### Step 2: Analyze Feature Request
1. Understand the user's goal from the issue description
2. Identify the user type (coach, parent, player, admin)
3. Determine scope and complexity
4. Identify all screens/flows that need mockups

### Step 3: Define Acceptance Criteria
Create testable criteria in Given/When/Then format:
```
Given [precondition]
When [action]
Then [expected result]
```

### Step 4: Create UI Mockups and Deploy to Surge

1. **Create mockup directory**:
   ```bash
   mkdir -p docs/mockups/issue-[ISSUE_NUMBER]
   ```

2. **Create mockup files**:
   - `index.html` - Mobile view (430px)
   - `web.html` - Desktop view (1440px)
   - Additional screens as needed
   - `ARCHITECTURE.md` - Technical documentation

3. **Required viewport sizes**:
   | Viewport | Width |
   |----------|-------|
   | Mobile | 430px |
   | Desktop | 1440px |

4. **Deploy to Surge**:
   ```bash
   npx surge docs/mockups/issue-[ISSUE_NUMBER] issue-[ISSUE_NUMBER]-mockup.surge.sh
   ```

   **IMPORTANT**: Surge is already logged in. Never pass a token or credentials - the existing session will be used automatically.

   The mockup will be available at: `https://issue-[ISSUE_NUMBER]-mockup.surge.sh`

### Step 5: Create Architecture Document

Create `docs/mockups/issue-[ISSUE_NUMBER]/ARCHITECTURE.md` with:
- Overview and approach
- Data models (TypeScript interfaces)
- API endpoints / Cloud Functions
- Security considerations
- Implementation phases
- Testing strategy

### Step 6: Update Issue Body

**Overwrite the issue body** with the standardized plan format:

```bash
gh issue edit [ISSUE_NUMBER] --body "$(cat <<'EOF'
## User Story
As a [user type], I want to [goal] so that [benefit]

## Acceptance Criteria
- [ ] Given [X], When [Y], Then [Z]
- [ ] Given [X], When [Y], Then [Z]

## Mockups
**Live Preview**: https://issue-[ISSUE_NUMBER]-mockup.surge.sh
**Local files**: `docs/mockups/issue-[ISSUE_NUMBER]/`

| Screen | File | Viewport |
|--------|------|----------|
| Mobile View | `index.html` | 430px |
| Desktop View | `web.html` | 1440px |

## User Flows
1. **[Flow Name]**: [Step 1] → [Step 2] → [Step 3]

## Technical Approach
- **UI Components**: [components needed]
- **Data Layer**: [Firestore/API changes]
- **New Files**: [files to create]
- **Modified Files**: [files to update]

## Architecture
See: `docs/mockups/issue-[ISSUE_NUMBER]/ARCHITECTURE.md`

## Implementation Phases
### Phase 1: [Name]
- [ ] Task 1
- [ ] Task 2

### Phase 2: [Name]
- [ ] Task 1
- [ ] Task 2

## TDD Template
`[user-workflow | user-interface | data-management | integration]`

---
*Plan generated by headless agent*
EOF
)"
```

### Step 7: Post Notification Comment

Post a **concise comment** with architecture overview:

```bash
gh issue comment [ISSUE_NUMBER] --body "$(cat <<'EOF'
## Implementation Plan Ready

I have updated the issue description with the proposed implementation plan.

### Architecture Overview
[2-3 sentence summary of the technical approach]

### Key Decisions
- [Decision 1]
- [Decision 2]

### Mockup Preview
https://issue-[N]-mockup.surge.sh

### Files Created
- `docs/mockups/issue-[N]/index.html` - Mobile mockup
- `docs/mockups/issue-[N]/web.html` - Desktop mockup
- `docs/mockups/issue-[N]/ARCHITECTURE.md` - Technical docs

### Next Steps
Please review the updated issue description and comment with any feedback or approval to proceed.
EOF
)"
```

### Step 8: EXIT

After posting the comment, **terminate immediately**. Do not wait for response.

---

## Design System Reference

All mockups MUST follow the design system.

### Button Hierarchy (Critical)
| Variant | Use Case | Rule |
|---------|----------|------|
| **Primary** | Main CTA | **ONE per section maximum** |
| **Secondary** | Alternative actions | Multiple allowed |
| **Tertiary** | Low priority | Multiple allowed |
| **Destructive** | Dangerous actions | As needed |

### Touch Targets (WCAG AAA)
- **Minimum**: 44px height/width
- **Preferred**: 56px for mobile
- **Spacing**: 8px minimum between targets

### Design Tokens
```css
/* Brand Colors */
--color-primary: #CB2323;      /* Hammers Red */
--color-primary-dark: #A01D1D;
--color-secondary: #DDA64E;    /* Hammers Gold */
--color-accent: #5E7037;       /* Hammers Green */

/* Semantic Colors */
--color-success: #10B981;
--color-warning: #F59E0B;
--color-error: #EF4444;
--color-info: #3B82F6;

/* Neutral Colors */
--color-background: #FFFFFF;
--color-background-secondary: #FAFAF9;
--color-surface: #FFFFFF;
--color-text-primary: #1C1917;
--color-text-secondary: #57534E;
--color-text-tertiary: #78716C;
--color-border: #E7E5E4;

/* Typography */
--font-family: 'Lato', -apple-system, BlinkMacSystemFont, sans-serif;

/* Spacing (4px base) */
--spacing-1: 4px;
--spacing-2: 8px;
--spacing-4: 16px;
--spacing-6: 24px;
--spacing-8: 32px;

/* Border Radius */
--radius-sm: 4px;
--radius-md: 8px;
--radius-lg: 12px;
```

### Ionicons (Required for Icons)
```html
<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
```

Common icons: `arrow-back`, `close-outline`, `search-outline`, `settings-outline`, `person-outline`, `people-outline`, `football-outline`

---

## Blocked State Handling

If you **cannot proceed** without user input, add the blocked label, post a question, and exit:

```bash
gh issue edit [ISSUE_NUMBER] --add-label "blocked"
gh issue comment [ISSUE_NUMBER] --body "$(cat <<'EOF'
## Clarification Needed

Before I can create the implementation plan, I need to understand:

1. [Specific question 1]
2. [Specific question 2]

Please reply with your preference and I will continue planning.
EOF
)"
```

Then **EXIT with failure** - this is a blocked state, not a success.

---

## Checklist Before Exit

- [ ] Read `.claude/patterns.md`
- [ ] Created `docs/mockups/issue-[N]/` directory
- [ ] Created `index.html` (mobile mockup)
- [ ] Created `web.html` (desktop mockup)
- [ ] Created `ARCHITECTURE.md`
- [ ] Deployed mockups to Surge (`npx surge`)
- [ ] Updated issue body with `gh issue edit`
- [ ] Posted notification comment with `gh issue comment`
- [ ] **EXIT**
